---
title: "Crop Quadrats by Area"
description: >
  The function `crop_area` is powerful when working with quadrats of different 
  sizes but the same density of points. This vignette will walk through why you 
  might want to crop quadrats based on area and how to go about using the 
  `crop_area` function. 
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Crop Quadrats by Area}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

The function `crop_area()` is powerful when working with quadrats of different sizes but the same density of points. This vignette will walk through why you might want to crop quadrats based on area and how to go about using the `crop_area()` function. 

When working with quadrats, the area sampled and the density of points sampled will affect diversity measures being conducted. When sampling a larger area, or a differing shaped area, the amount of heterogeneity and number of possible species can differ. Simply averaging the cover of individuals or proportional abundance will be influenced by size of the quadrat, introducing sources of error or variation between samples [Anderson and Marcus 1993](#References). 

If the identification of substrate and organisms have already occurred for quadrats of different sizes, this vignette can demonstrate how to subset, or 'crop' the area of the quadrats all to the same size while maintaining similar effort and comparability between samples. For this the sampling effort needs to be roughly the same per unit area, so that the cropped areas will have the same sampling effort. 

- If uniform grids of the same area are used to identify the organism or substrate underneath, cropping to a smaller area will be exactly the same effort with the same number of points in each cropped area. Ex splitting each quadrat into 10cm by 10cm squares and identifying the substrate or organism under at the vertexes of the squares. 

- If random points are used are used to identify the organism or substrate underneath, the density of points will need to be the same per unit area, so that on average, the cropped areas will contain the same number of points. Ex randomly identifying 100 points in a 1m by 1m quadrat and randomly identifying 54 points in a 0.9m by 0.6m quadrat, so both have an average density of 1 point for every cm^2^ if quadrat area.

- If the full area of the quadrat is identified, then the same effort will be applied to any area, though this method of cropping will not be of value. 

Additionally, this method is beneficial because it still ensures spatial relationships between organisms within each quadrat. If a subset of the points was randomly selected, like 54 out of the 100 identified points, these points would still cover the whole quadrat and would therefore still be representative of a larger sampling effort, than 54 points out of the 100, but all aggregated in the bottom left corner of the quadrat. This is the method this vignette will explore, and both random and gridded points will be displayed.

First, some packages need to be loaded, the `quadcleanR` package and `ggplot2` to help you visualize the data and results. 

```{r load package, message = FALSE}

library(quadcleanR)
library(ggplot2)

```


```{r create data set, out.width = '45%', fig.show='hold'}

#Creating the data file
tags <- c("Clad", "Sinu", "Sarco", "Loph")

rep <- c(rep("Q1", times = 100),
          rep("Q1", times = 100),
          rep("Q1", times = 100),
          rep("Q1", times = 100))
row <- c(sample(x = c(1:2000), size = 100, replace = TRUE),
         sample(x = c(1:2000), size = 100, replace = TRUE),
         sample(x = c(1:2000), size = 100, replace = TRUE),
         sample(x = c(1:2000), size = 100, replace = TRUE))
column <- c(sample(x = c(1:2000), size = 100, replace = TRUE),
            sample(x = c(1:2000), size = 100, replace = TRUE),
            sample(x = c(1:2000), size = 100, replace = TRUE),
            sample(x = c(1:2000), size = 100, replace = TRUE))
label <- c(sample(x = tags, size = 100, replace = TRUE),
           sample(x = tags, size = 100, replace = TRUE),
           sample(x = tags, size = 100, replace = TRUE),
           sample(x = tags, size = 100, replace = TRUE))
coral_annotations <- data.frame(rep, row, column, label)

ggplot(coral_annotations[1:100,], aes(x = column, y = row)) +
  geom_point() +
  theme_classic() +
  labs(y = "", x = "", title = "Quadrat 1")

ggplot(coral_annotations[101:200,], aes(x = column, y = row)) +
  geom_point() +
  theme_classic() +
  labs(y = "", x = "", title = "Quadrat 2")

ggplot(coral_annotations[201:300,], aes(x = column, y = row)) +
  geom_point() +
  theme_classic() +
  labs(y = "", x = "", title = "Quadrat 3")

ggplot(coral_annotations[301:400,], aes(x = column, y = row)) +
  geom_point() +
  theme_classic() +
  labs(y = "", x = "", title = "Quadrat 4")


```




```{r}
# crop_area_coral <- crop_area(data = coral_annotations, row = "row",
#                              column = "column", id = "site", dim = c(0.5, 0.5))
# 
# site_1 <- subset(crop_area_coral, site == "Site1")
# site_2 <- subset(crop_area_coral, site == "Site2")
# site_3 <- subset(crop_area_coral, site == "Site3")
# site_4 <- subset(crop_area_coral, site == "Site4")
# 
# plot(x = coral_annotations$column[1:100], y = coral_annotations$row[1:100],
#      ylab = "", xlab = "", main = "Site1") +
#   points(site_1$column, site_1$row, col = "red") +
#   polygon(x = c(0, 0, 0.5*max(coral_annotations$column[1:100]),
#                 0.5*max(coral_annotations$column[1:100])),
#          y = c(0, 0.5*max(coral_annotations$row[1:100]),
#                 0.5*max(coral_annotations$row[1:100]), 0),
#           border = "red",
#           lwd = 2)
# plot(x = coral_annotations$column[101:200], y = coral_annotations$row[101:200],
#      ylab = "", xlab = "", main = "Site2") +
#   points(site_2$column, site_2$row, col = "red") +
#   polygon(x = c(0, 0, 0.5*max(coral_annotations$column[101:200]),
#                 0.5*max(coral_annotations$column[101:200])),
#           y = c(0, 0.5*max(coral_annotations$row[101:200]),
#                 0.5*max(coral_annotations$row[101:200]), 0),
#           border = "red",
#           lwd = 2)
# plot(x = coral_annotations$column[201:300], y = coral_annotations$row[201:300],
#      ylab = "", xlab = "", main = "Site3") +
#   points(site_3$column, site_3$row, col = "red") +
#   polygon(x = c(0, 0, 0.5*max(coral_annotations$column[201:300]),
#                 0.5*max(coral_annotations$column[201:300])),
#           y = c(0, 0.5*max(coral_annotations$row[201:300]),
#                 0.5*max(coral_annotations$row[201:300]), 0),
#           border = "red",
#           lwd = 2)
# plot(x = coral_annotations$column[301:400], y = coral_annotations$row[301:400],
#      ylab = "", xlab = "", main = "Site4") +
#   points(site_4$column, site_4$row, col = "red") +
#   polygon(x = c(0, 0, 0.5*max(coral_annotations$column[301:400]),
#                 0.5*max(coral_annotations$column[301:400])),
#           y = c(0, 0.5*max(coral_annotations$row[301:400]),
#                 0.5*max(coral_annotations$row[301:400]), 0),
#           border = "red",
#           lwd = 2)
# 
# coral_annotations$col_dim <- 2000
# coral_annotations$row_dim <- 2000
# 
# crop_area_coral_2 <- crop_area(data = coral_annotations, row = "row",
#                                column = "column", id = "site", dim = c(0.5, 0.5),
#                                res = TRUE, res_dim_x = "col_dim", res_dim_y = "row_dim")
# 
# site_1_2 <- subset(crop_area_coral_2, site == "Site1")
# site_2_2 <- subset(crop_area_coral_2, site == "Site2")
# site_3_2 <- subset(crop_area_coral_2, site == "Site3")
# site_4_2 <- subset(crop_area_coral_2, site == "Site4")
# 
# 
# plot(x = coral_annotations$column[1:100], y = coral_annotations$row[1:100],
#      ylab = "", xlab = "", main = "Site1") +
#   points(site_1_2$column, site_1_2$row, col = "red") +
#   polygon(x = c(0, 0, 0.5*2000, 0.5*2000),
#           y = c(0, 0.5*2000, 0.5*2000, 0),
#           border = "red",
#           lwd = 2)
# plot(x = coral_annotations$column[101:200], y = coral_annotations$row[101:200],
#      ylab = "", xlab = "", main = "Site2") +
#   points(site_2_2$column, site_2_2$row, col = "red") +
#   polygon(x = c(0, 0, 0.5*2000, 0.5*2000),
#           y = c(0, 0.5*2000, 0.5*2000, 0),
#           border = "red",
#           lwd = 2)
# plot(x = coral_annotations$column[201:300], y = coral_annotations$row[201:300],
#      ylab = "", xlab = "", main = "Site3") +
#   points(site_3_2$column, site_3_2$row, col = "red") +
#   polygon(x = c(0, 0, 0.5*2000, 0.5*2000),
#           y = c(0, 0.5*2000, 0.5*2000, 0),
#           border = "red",
#           lwd = 2)
# plot(x = coral_annotations$column[301:400], y = coral_annotations$row[301:400],
#      ylab = "", xlab = "", main = "Site4") +
#   points(site_4_2$column, site_4_2$row, col = "red") +
#   polygon(x = c(0, 0, 0.5*2000, 0.5*2000),
#           y = c(0, 0.5*2000, 0.5*2000, 0),
#           border = "red",
#           lwd = 2)


```

# <a name="References" />References

Anderson, S., and L. F. Marcus. 1993. Effect of quadrat size on measurements of species density. Journal of Biogeography 20: 421-428.
